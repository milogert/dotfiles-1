#!/usr/bin/env bash

export DOTFILES_DIR
export XDG_CONFIG_HOME
DOTFILES_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
XDG_CONFIG_HOME="$HOME/.config"

set -e -o pipefail -p

# Keep the computer awake for the duration of this script.
[[ $(command -v caffeinate) ]] && caffeinate -dusw $$ &

# Ask for the administrator password
sudo -v

# sudo keep-alive
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

# INT/TERM trap
trap 'exit 1' INT TERM

# Bunch of symlinks

ln -sfv "$DOTFILES_DIR/runcom/.ackrc" ~
ln -sfv "$DOTFILES_DIR/runcom/.bash_profile" ~
ln -sfv "$DOTFILES_DIR/runcom/.gemrc" ~
ln -sfv "$DOTFILES_DIR/runcom/.inputrc" ~
ln -sfv "$DOTFILES_DIR/runcom/.nvimrc" ~
ln -sfv "$DOTFILES_DIR/git/.gitconfig" ~

# macOS Install

if [[ $(uname -s) == 'Darwin' ]]; then
  if [[ -z "$(xcode-select -p)" ]]; then
    echo "Either XCode isn't installed or isn't linked. Install it, or link with xcode-select."
    exit 1
  fi

  . "$DOTFILES_DIR/installs/homebrew"
  . "$DOTFILES_DIR/installs/node"
  . "$DOTFILES_DIR/installs/ruby"
  . "$DOTFILES_DIR/installs/haskell"
  . "$DOTFILES_DIR/installs/git"
  . "$DOTFILES_DIR/installs/macos"
fi
